<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <record id="account.view_account_period_tree" model="ir.ui.view">
            <field name="name">account.period.tree</field>
            <field name="model">account.period</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
              <tree colors="blue:state in ('draft');gray:state in ('done') " string="Period">
                    <field name="name"/>
                    <field name="code"/>
                    <field name="date_start"/>
                    <field name="date_stop"/>
                    <field name="special"/>
                    <field name="state"/>
                    <button name="revaluate_period" states="draft" string="Close Period" type="object" icon="terp-camera_test"/>
                </tree>
            </field>
        </record>
        
        <record id="view_account_revaluation" model="ir.ui.view">
            <field name="name">account.revaluation.form</field>
            <field name="model">account.revaluation</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Revaluate Period Entries">
                <group colspan="4" col="2">
	                   <group colspan="4" col="4">
	                       <field name="period_id" domain="[('state','!=','done')]" required="1" attrs="{'readonly':[('state','!=','draft')]}"/>
	                       <field name="name"/>
	                   </group>
	                   <button string="Fetch Entries"
                                                type="object"
                                                name="compute_totals"
                                                icon="gtk-execute"/>
	                   <notebook>
	                       <page string="Foreign Exchanges">
	                           <group colspan="4">
	                               <field name="exchange_ids" mode="tree" nolabel="1" readonly="1">
	                                   <tree string="Exchanges">
		                                   <field name="name"/>
		                                   <field name="period_id"/>
		                                   <field name="journal_id"/>
		                                   <field name="src"/>
		                                   <field name="src_amount"/>
		                                   <field name="dest"/>
		                                   <field name="dest_amount"/>
		                                   <field name="rate"/>
	                                   </tree>
	                               </field>
	                           </group>
	                           <separator string="Totals based on company currency" colspan="4"/>
	                           <group colspan="4" col="4">
	                               <group colspan="2" col="2">
	                                   <separator string="Source Account Exchanges" colspan="2"/>
	                                   <group colspan="2" col="2">
	                                   <field name="src_total1" readonly="1"/>
	                                   <field name="dest_total1" readonly="1"/>
	                                   </group>
	                               </group>
	                               <group colspan="2" col="2">
                                       <separator string="Destination Account Exchanges" colspan="2"/>
                                       <group colspan="2" col="2">
                                       <field name="src_total2" readonly="1"/>
                                       <field name="dest_total2" readonly="1"/>
                                       </group>
                                   </group>
	                           </group>
	                           <separator string="Secondary Currency Details" colspan="4"/>
	                           <group colspan="4" col="4">
	                               <field name="second_curr" readonly="1"/>
	                               <field name="start_rate" readonly="1"/>
	                               <field name="weighted_rate" readonly="1"/>
	                               <field name="post_rate"/>
	                           </group>
	                       </page>
	                       <page string="Beginning Balances">
	                           <field name="account_ids" mode="tree" nolabel="1" readonly="1">
	                               <tree string="Accounts for Revaluation">
	                                   <field name="account_id"/>
	                                   <field name="bal_beg"/>
	                                   <field name="comp_curr_bal"/>
	                                   <field name="second_curr_bal"/>
	                                   <field name="bal_ap"/>
	                                   <field name="diff"/>
	                                   <field name="bal_end"/>
	                               </tree>
	                           </field>
                           </page>
                           <page string="Entries for Revaluation">
                                <field name="entry_ids" mode="tree" nolabel="1" readonly="1">
                                    <tree string="Accounting Entries">
                                        <field name="date"/>
                                        <field name="name"/>
                                        <field name="account_id"/>
                                        <field name="analytic_account_id"/>
                                        <field name="debit"/>
                                        <field name="credit"/>
                                        <field name="currency_id" string="Encoding Currency"/>
                                        <field name="amount_currency" string="Encoding Amount"/>
                                    </tree>
                                </field>
                           </page>
                           <page string="Revaluation Result">
                           </page>
					   </notebook>
					   <group colspan="4" col="10">
					   <field name="state" readonly="1"/>
					   <button string="Get Currencies"
	                                            type="object"
	                                            name="get_details"
	                                            icon="gtk-execute"
	                                            attrs="{'invisible': [('state','!=','draft')]}"
	                                            confirm="Are you sure??"
	                                            />
                       <button string="Adjust per Post Rate"
                                                type="object"
                                                name="adjust_post_rate"
                                                icon="gtk-execute"
                                                attrs="{'invisible': [('state','!=','test_reval')]}"
                                                />
                       <button string="Check Gain Loss"
                                                type="object"
                                                name="check_gain_loss_accounts"
                                                icon="gtk-execute"
                                                attrs="{'invisible': [('state','!=','test_reval')]}"
                                                />
                       <button string="Compute Balance AP"
                                                type="object"
                                                name="compute_balap"
                                                icon="gtk-execute"
                                                attrs="{'invisible': [('state','!=','data_fetched')]}"
                                                />
                       <button string="Check Revaluation"
                                                type="object"
                                                name="reval_entries"
                                                icon="gtk-execute"
                                                attrs="{'invisible': [('state','!=','balap_computed')]}"
                                                />
	                    </group>
	           </group>   
               </form>
            </field>
        </record>
        
        <record id="action_account_revaluation" model="ir.actions.act_window">
            <field name="name">Revaluate Entries</field>
            <field name="res_model">account.revaluation</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_account_revaluation"/>
            <field name="target">new</field>
        </record>
        <!-- 
		<menuitem
            name="Revaluate Entries"
            parent="account.menu_account_end_year_treatments"
            action="action_account_revaluation"
            id="menu_account_revaluation"
            sequence="50"
           />
 -->
    </data>
</openerp>
