<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <record id="account.view_account_period_tree" model="ir.ui.view">
            <field name="name">account.period.tree</field>
            <field name="model">account.period</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
              <tree colors="blue:state in ('draft');gray:state in ('done') " string="Period">
                    <field name="name"/>
                    <field name="code"/>
                    <field name="date_start"/>
                    <field name="date_stop"/>
                    <field name="special"/>
                    <field name="state"/>
                    <button name="revaluate_period" states="draft" string="Close Period" type="object" icon="terp-camera_test"/>
                </tree>
            </field>
        </record>
        
        <record id="view_account_revaluation" model="ir.ui.view">
            <field name="name">account.revaluation.form</field>
            <field name="model">account.revaluation</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Revaluate Period Entries">
                <group colspan="4" col="2">
	                   <group colspan="4" col="4">
	                       <field name="period_id" domain="[('state','!=','done')]" required="1" attrs="{'readonly':[('state','!=','draft')]}"/>
	                       <field name="name"/>
	                   </group>
	                   <separator string="Currency" colspan="4"/>
	                   <group colspan="4" col="4">
	                       <field name="comp_curr" readonly="1"/>
	                       <field name="second_curr" readonly="1"/>
	                   </group>
	                   <separator string="Exchange Rate" colspan="4"/>
	                   <group colspan="4" col="4">
                           <field name="start_rate" readonly="1"/>
                           <field name="weighted_rate" readonly="1"/>
                           <field name="end_rate" required="1"/>
                           <field name="post_rate"/>
                       </group>
	                   <button string="Fetch Entries"
                                                type="object"
                                                name="fetch_accounts"
                                                icon="gtk-execute"/>
	                   <notebook>
	                       <page string="Foreign Exchanges">
	                           <group colspan="4">
	                               <field name="src_exchange_ids" mode="tree" nolabel="1" readonly="1" colspan="4">
	                                   <tree string="From Company Currency Exchanges" limit="100">
		                                   <field name="name"/>
		                                   <field name="period_id"/>
		                                   <field name="journal_id"/>
		                                   <field name="src"/>
		                                   <field name="src_amount" sum="Total"/>
		                                   <field name="dest"/>
		                                   <field name="dest_amount" sum="Total"/>
		                                   <field name="rate"/>
	                                   </tree>
	                               </field>
	                               <field name="dest_exchange_ids" mode="tree" nolabel="1" readonly="1" colspan="4">
                                       <tree string="To Company Currency Exchanges">
                                           <field name="name"/>
                                           <field name="period_id"/>
                                           <field name="journal_id"/>
                                           <field name="src"/>
                                           <field name="src_amount" sum="Total"/>
                                           <field name="dest"/>
                                           <field name="dest_amount" sum="Total"/>
                                           <field name="rate"/>
                                       </tree>
                                   </field>
	                           </group>
	                       </page>
	                       <page string="Revaluated Accounts">
	                           <field name="account_ids" mode="tree" nolabel="1" readonly="1">
	                               <tree string="Accounts for Revaluation">
	                                   <field name="account_id" readonly="1"/>
	                                   <field name="analytic_id" readonly="1"/>
	                                   <field name="gainloss_account_id" readonly="1"/>
	                                   <field name="comp_bal_beg" readonly="1"/>
	                                   <field name="bal_ap" readonly="1"/>
	                                   <field name="adjustment" readonly="1"/>
	                                   <field name="diff" readonly="1" sum="Total"/>
	                                   <field name="bal_end" readonly="1"/>
	                               </tree>
	                           </field>
                           </page>
                           <page string="Pool Accounts">
                                <field name="pool_account_ids" mode="tree" nolabel="1" readonly="1">
                                    <tree string="Accounts included in Pool Equivalent">
                                        <field name="account_id" readonly="1"/>
                                        <field name="currency_id" readonly="1"/>
                                        <field name="comp_bal_beg" readonly="1" sum="Total"/>
                                        <field name="bal_ap" readonly="1" sum="Total"/>
                                        <field name="diff" readonly="1" sum="Total"/>
                                        <field name="bal_end" readonly="1" sum="Total"/>
                                    </tree>
                                </field>
                           </page>
                           <page string="Revaluation Computation">
	                           <group colspan="4" col="4">
		                           <separator string="Company Currency" colspan="2"/>
		                           <separator string="Secondary Currency" colspan="2"/>
	                           </group>
	                           <group colspan="4" col="4">
	                               <separator string="Beginning" colspan="2"/>
	                               <separator string="Beginning" colspan="2"/>
	                               <field name="pool_equivalent_beg_comp" colspan="2" readonly="1"/>
	                               <field name="pool_equivalent_beg_second" colspan="2" readonly="1"/>
	                               <field name="pool_total_beg" colspan="4" readonly="1"/>
	                               <field name="portion_factor_beg_comp" readonly="1"/>
	                               <field name="portion_factor_beg_second" readonly="1"/>
	                               <field name="rate_change_beg_comp" readonly="1"/>
	                               <field name="rate_change_beg_second" readonly="1"/>
	                               <field name="reval_beg" readonly="1"/>
	                           </group>
	                           <group colspan="4" col="4">
	                               <separator string="After Posting" colspan="2"/>
	                               <separator string="After Posting" colspan="2"/>
	                               <field name="pool_equivalent_ap_comp" colspan="2" readonly="1"/>
	                               <field name="pool_equivalent_ap_second" colspan="2" readonly="1"/>
	                               <field name="pool_total_ap" colspan="4" readonly="1"/>
	                               <field name="portion_factor_ap_comp" readonly="1"/>
	                               <field name="portion_factor_ap_second" readonly="1"/>
	                               <field name="rate_change_ap_comp" readonly="1"/>
	                               <field name="rate_change_ap_second" readonly="1"/>
	                               <field name="reval_ap" readonly="1"/>
	                           </group>
                           </page>
                           <page string="Journal Entries">
                            <group colspan="4" col="2">
                                <field name="move_id" invisible="1"/>
                                <field name="move_ids" mode="tree" nolabel="1">
                                    <tree string="Revaluation Entries">
                                        <field name="date" string="Revaluation Date"/>
                                        <field name="account_id"/>
                                        <field name="analytic_account_id"/>
                                        <field name="debit" sum="Total Debit"/>
                                        <field name="credit" sum="Total Credit"/>
                                        <field name="currency_id" string="Encoding Currency"/>
                                        <field name="amount_currency" string="Encoding Amount"/>
                                    </tree>
                                </field>
                            </group>
                        </page>
					   </notebook>
					   <group colspan="4" col="10">
					   <field name="state" readonly="1"/>
					   <button string="Get Currencies"
	                                            type="object"
	                                            name="get_details"
	                                            icon="gtk-execute"
	                                            attrs="{'invisible': [('state','!=','draft')]}"
	                                            confirm="Are you sure??"
	                                            />
                       <button string="Adjust per Post Rate"
                                                type="object"
                                                name="adjust_post_rate"
                                                icon="gtk-execute"
                                                attrs="{'invisible': [('state','!=','test_reval')]}"
                                                />
                       <button string="Check Gain Loss"
                                                type="object"
                                                name="check_gain_loss_accounts"
                                                icon="gtk-execute"
                                                attrs="{'invisible': [('state','!=','test_reval')]}"
                                                />
                       <button string="Compute Balance AP"
                                                type="object"
                                                name="compute_balap"
                                                icon="gtk-execute"
                                                attrs="{'invisible': [('state','!=','data_fetched')]}"
                                                />
                       <button string="Check Revaluation"
                                                type="object"
                                                name="reval_entries"
                                                icon="gtk-execute"
                                                attrs="{'invisible': [('state','!=','balap_computed')]}"
                                                />
	                    </group>
	           </group>   
               </form>
            </field>
        </record>
        
        <record id="action_account_revaluation" model="ir.actions.act_window">
            <field name="name">Revaluate Entries</field>
            <field name="res_model">account.revaluation</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_account_revaluation"/>
            <field name="target">new</field>
        </record>
        <!-- 
		<menuitem
            name="Revaluate Entries"
            parent="account.menu_account_end_year_treatments"
            action="action_account_revaluation"
            id="menu_account_revaluation"
            sequence="50"
           />
 -->
    </data>
</openerp>
